{% extends 'base.html' %} {% load static %} {% block content %}
<!-- Toast Notification -->
{% if messages %}
<div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
  <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <i class="fas fa-bell me-2"></i>
      <strong class="me-auto">Notification</strong>
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="toast"
        aria-label="Close"
      ></button>
    </div>
    <div class="toast-body">
      {% for message in messages %}
      <div class="d-flex align-items-center">
        {% if message.tags == 'success' %}
        <i class="fas fa-check-circle text-success me-2"></i>
        {% elif message.tags == 'error' %}
        <i class="fas fa-exclamation-circle text-danger me-2"></i>
        {% else %}
        <i class="fas fa-info-circle text-info me-2"></i>
        {% endif %} {{ message }}
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}

<div class="container-fluid mt-4">
  <!-- Profile Dropdown -->
  <div class="position-absolute top-0 end-0 m-3">
    <div class="dropdown">
      <button
        class="btn btn-link text-dark dropdown-toggle"
        type="button"
        id="profileDropdown"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        <i class="fas fa-user-circle fa-2x"></i>
      </button>
      <ul
        class="dropdown-menu dropdown-menu-end"
        aria-labelledby="profileDropdown"
      >
        <li><h6 class="dropdown-header">Welcome, {{ user.username }}</h6></li>
        <li><hr class="dropdown-divider" /></li>
        <li>
          <button
            class="dropdown-item"
            data-bs-toggle="modal"
            data-bs-target="#changePasswordModal"
          >
            <i class="fas fa-key me-2"></i>Change Password
          </button>
        </li>
        <li>
          <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="dropdown-item text-danger">
              <i class="fas fa-sign-out-alt me-2"></i>Logout
            </button>
          </form>
        </li>
      </ul>
    </div>
  </div>

  <!-- Main Content Section -->
  <div class="row mt-4">
    <div class="col-12">
      <!-- Tabs -->
      <ul class="nav nav-tabs" id="adminTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="packages-tab"
            data-bs-toggle="tab"
            data-bs-target="#packages"
            type="button"
            role="tab"
          >
            Packages Management
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="mikrotik-tab"
            data-bs-toggle="tab"
            data-bs-target="#mikrotik"
            type="button"
            role="tab"
          >
            Mikrotik
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content mt-3" id="adminTabsContent">
        <!-- Packages Tab -->
        <div class="tab-pane fade show active" id="packages" role="tabpanel">
          <div class="card">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h5 class="card-title">Package Management</h5>
                <button class="btn btn-primary" onclick="openAddModal()">
                  <i class="fas fa-plus"></i> Add New Package
                </button>
              </div>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Period</th>
                      <th>Price (Ksh)</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for package in packages %}
                    <tr>
                      <td>{{ package.id }}</td>
                      <td>{{ package.period_in_hours }} hours</td>
                      <td>{{ package.price }}</td>
                      <td>
                        <button
                          class="btn btn-sm btn-warning me-2"
                          onclick="openEditModal('{{ package.id }}', '{{ package.period_in_hours }}', '{{ package.price }}')"
                        >
                          <i class="fas fa-edit"></i>
                        </button>
                        <button
                          class="btn btn-sm btn-danger"
                          onclick="deletePackage('{{ package.id }}')"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Mikrotik Tab -->
        <div class="tab-pane fade" id="mikrotik" role="tabpanel">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Mikrotik Management</h5>
              <p class="card-text">
                Mikrotik management features will be added here.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Package Modal -->
<div class="modal fade" id="packageModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">Add New Package</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <form id="packageForm">
        <div class="modal-body">
          <input type="hidden" id="packageId" />
          <div class="mb-3">
            <label for="periodValue" class="form-label">Period (hours):</label>
            <input
              type="number"
              class="form-control"
              id="periodValue"
              name="periodValue"
              required
            />
          </div>
          <div class="mb-3">
            <label for="price" class="form-label">Price (Ksh):</label>
            <input
              type="number"
              class="form-control"
              id="price"
              name="price"
              required
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Change Password</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <form method="post" action="{% url 'change_password' %}">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label for="old_password" class="form-label"
              >Current Password</label
            >
            <input
              type="password"
              class="form-control"
              id="old_password"
              name="old_password"
              required
            />
          </div>
          <div class="mb-3">
            <label for="new_password1" class="form-label">New Password</label>
            <input
              type="password"
              class="form-control"
              id="new_password1"
              name="new_password1"
              required
            />
          </div>
          <div class="mb-3">
            <label for="new_password2" class="form-label"
              >Confirm New Password</label
            >
            <input
              type="password"
              class="form-control"
              id="new_password2"
              name="new_password2"
              required
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Close
          </button>
          <button type="submit" class="btn btn-primary">Change Password</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script src="{% static 'mikrotikapp/js/admin.js' %}"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize toast
    var toastEl = document.querySelector(".toast");
    if (toastEl) {
      var toast = new bootstrap.Toast(toastEl, {
        autohide: true,
        delay: 5000,
        animation: true,
      });

      // Show the toast
      toast.show();

      // Automatically hide the toast after 5 seconds
      setTimeout(function () {
        toast.hide();
      }, 5000);

      // Add event listener for when the toast is hidden
      toastEl.addEventListener("hidden.bs.toast", function () {
        // Remove the toast element from the DOM
        toastEl.parentElement.remove();
      });
    }
  });
</script>
{% endblock %}
